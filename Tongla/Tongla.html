<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tongla Monitoring Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- นำข้อมูลที่ Shell script สร้าง -->
    <script type="module" src="./Tongla.js"></script>
  </head>
  <body
    class="bg-white text-gray-800 min-h-screen flex flex-col items-center justify-center p-6 transition-colors duration-300"
  >
    <div
      class="max-w-4xl w-full bg-white shadow-xl rounded-xl p-8 border border-gray-200 hover:shadow-2xl transition-all duration-300"
    >
      <h1
        class="text-3xl font-bold text-center mb-6 text-indigo-600 animate-pulse"
      >
        Tongla System Monitor
      </h1>

      <div id="info" class="grid grid-cols-2 gap-6">
        <div class="col-span-1">
          <p><strong>User:</strong> <span id="user"></span></p>
          <p><strong>IP:</strong> <span id="ip"></span></p>
          <p><strong>OS:</strong> <span id="os"></span></p>
          <p><strong>Kernel:</strong> <span id="kernel"></span></p>
        </div>
        <div class="col-span-1">
          <p><strong>CPU Usage:</strong> <span id="cpu"></span>%</p>
          <p>
            <strong>Memory Usage:</strong>
            <span id="mem-used"></span> / <span id="mem-total"></span> MB
          </p>
          <p>
            <strong>Storage Usage:</strong>
            <span id="store-used"></span> / <span id="store-total"></span>
          </p>
          <p><strong>Last Updated:</strong> <span id="updated"></span></p>
        </div>
      </div>

      <!-- กราฟภาพรวม -->
      <div class="mt-8">
        <canvas id="systemChart" class="w-full h-64"></canvas>
      </div>

      <!-- แสดง process -->
      <div class="mt-6">
        <h2 class="text-xl font-semibold text-indigo-500 mb-2">
          Top Processes
        </h2>
        <pre
          id="processes"
          class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto shadow-inner"
        ></pre>
      </div>
    </div>

    <script type="module">
      import { systemData } from "./Tongla.js";

      document.getElementById("user").textContent = systemData.user;
      document.getElementById("ip").textContent = systemData.ip;
      document.getElementById("os").textContent = systemData.os;
      document.getElementById("kernel").textContent = systemData.kernel;
      document.getElementById("cpu").textContent =
        systemData.cpuUsage.toFixed(1);
      document.getElementById("mem-used").textContent = systemData.memory.used;
      document.getElementById("mem-total").textContent = systemData.memory.total;
      document.getElementById("store-used").textContent =
        systemData.storage.used;
      document.getElementById("store-total").textContent =
        systemData.storage.total;
      document.getElementById("updated").textContent = systemData.lastUpdated;
      document.getElementById("processes").textContent =
        systemData.processes.trim();

      // สร้างกราฟ
      const ctx = document.getElementById("systemChart");
      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["CPU Usage", "Memory Usage", "Storage Usage"],
          datasets: [
            {
              data: [
                systemData.cpuUsage,
                (systemData.memory.used / systemData.memory.total) * 100,
                parseFloat(
                  (parseInt(systemData.storage.used) /
                    parseInt(systemData.storage.total)) *
                    100
                ) || 0,
              ],
              backgroundColor: [
                "rgba(99, 102, 241, 0.8)",
                "rgba(34, 197, 94, 0.7)",
                "rgba(239, 68, 68, 0.7)",
              ],
              borderWidth: 2,
            },
          ],
        },
      });
    </script>
  </body>
</html>
